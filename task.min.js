!function(t,r){if("function"==typeof define&&define.amd)define(["require","lodash"],function(e,s){var n=r(s);return e.specified("khoaijs")&&e(["khoaijs"],function(t){t.Task=n}),t.Task=n,n});else{var e=r(t._);t.Khoai&&(t.Khoai.Task=e),t.Task=e}}(this,function(t){"use strict";function r(r){this.id=t.uniqueId("Task_"),this.name="",this.options={},this.handler=r||null,this._result=null,this._error=null}function e(t,r,e){try{r.bind(t)(e,t.setProcessResult.bind(t),t.setProcessError.bind(t))}catch(r){t.setProcessError(r.message||r.description,r.number||0)}}function s(t,r,e){r.process(e),t._result=r.getResult(),t._error=r.getError()}var n={};return r.prototype.option=function(r,e){var s=this;return t.isObject(r)?t.each(r,function(r,e){t.set(s.options,e,r)}):t.set(this.options,r,e),this},r.prototype.isError=function(){return!t.isNull(this._error)},r.prototype.getError=function(){return this.isError()?t.pick(t.extend({code:0,message:""},t.isObject(this._error)?this._error:{}),"code","message"):null},r.prototype.getResult=function(){return this._result},r.prototype.setProcessResult=function(t){this._result=t,this._error=null},r.prototype.setProcessError=function(t,r){this._result=null,this._error={message:t,code:r||0}},r.prototype.process=function(n){var i=this;return this._result=t.cloneDeep(n),this._error=null,t.isString(this.handler)&&(this.handler=t.castArray(this.handler)),t.isFunction(this.handler)?e(this,this.handler,n):this.handler instanceof r?s(this,this.handler,i._result):t.isArray(this.handler)?t.find(this.handler,function(e){var n;return n=t.isString(e)?r.factory(e):new r(e),s(i,n,i._result),i.isError()}):t.isObject(this.handler)&&t.find(this.handler,function(e,n){var o=r.factory(n);return t.isEmpty(e)||o.options(e),s(i,o,i._result),i.isError()}),!this.isError()},r.isRegistered=function(t){return n.hasOwnProperty(t)},r.list=function(){return Object.keys(n)},r.register=function(e,s,i){if(t.isObject(e)){if(i=t.isObject(s)?s:{},!((s=e)instanceof r))throw new Error("Task name is unknown");e=s.name}n[e]={handler:s,options:i||{}}},r.factory=function(e,s){if(r.isRegistered(e)){var i=n[e],o=new r;return o.name=e,o.handler=i.handler,o.options=i.options,t.isObject(s)&&o.option(s),o}throw new Error("Create an unregistered task: "+e)},r.apply=function(e,s){var n={data:t.cloneDeep(e)};if(!t.isEmpty(s)){s=t.castArray(s);var i=[];t.each(s,function(e){t.isString(e)?e=r.factory(e):!t.isObject(e)||e instanceof r||(e=t.extend({task:"",options:{}}),t.isString(e.task)?e.task=r.factory(e.task,e.options):e.task instanceof r&&t.each(options,function(t,r){e.task.option(r,t)}),e=e.task),i.push(e)}),t.find(i,function(r){if(!r.process(t.cloneDeep(n.data)))return delete n.data,n.error=r.getError(),!0;n.data=r.getResult()})}return n},r.register("DataSource",function(r,e,s){var n=this.options.path;if(!t.isString(n)&&!t.isNumber(n))throw new Error("Path must be string or number");if(t.isString(n)&&t.isEmpty(n))throw new Error("Path is empty");return t.isObject(r)?t.has(r,n)?e(t.get(r,n)):s("Ajax result path not found"):s("Response must be an object")},{path:""}),r});
//# sourceMappingURL=task.min.js.map
